- defaults:
    link:
      relink: true

- clean: ['~']

# Install cross-platform configs
- crossplatform-link:
    ~/.gitconfig: config/git/gitconfig
    ~/.gitignore_global: config/git/gitignore_global

# Install windows specific configs
- crossplatform-shell:
    # Create directories before symlinking files
    - command: if not exist "%USERPROFILE%\Documents\PowerShell" mkdir "%USERPROFILE%\Documents\PowerShell"
      platform: win32
    - command: if not exist "%USERPROFILE%\AppData\Local\Packages\Microsoft.WindowsTerminal_8wekyb3d8bbwe\LocalState" mkdir "%USERPROFILE%\AppData\Local\Packages\Microsoft.WindowsTerminal_8wekyb3d8bbwe\LocalState"
      platform: win32
    - command: if not exist "%USERPROFILE%\AppData\Local\nvim" mkdir "%USERPROFILE%\AppData\Local\nvim"
      platform: win32
    # Install applications using windows package manager
    # winget returns $False when it goes to install an application that is already installed
    # This is an undesirable behaviour for idempotent scripts, as a workaround I'm checking if the return code is -1978335135 to know if the application is already installed
    # winget return codes: https://github.com/microsoft/winget-cli/blob/master/doc/windows/package-manager/winget/returnCodes.md#general-errors
    - command: powershell -Command "winget install Microsoft.WindowsTerminal --source winget --no-upgrade; if ($? -eq $True -or $LASTEXITCODE -eq -1978335135) { $True } else { $False }"
      platform: win32
    - command: powershell -Command "winget install Microsoft.Powershell --source winget --no-upgrade; if ($? -eq $True -or $LASTEXITCODE -eq -1978335135) { $True } else { $False }"
      platform: win32
    - command: powershell -Command "winget install Microsoft.PowerToys --source winget --no-upgrade; if ($? -eq $True -or $LASTEXITCODE -eq -1978335135) { $True } else { $False }"
      platform: win32
    # Debian WSL
    - command: powershell -Command "winget install --Id '9MSVKQC78PK6' --source msstore --no-upgrade --accept-source-agreements --accept-package-agreements; if ($? -eq $True -or $LASTEXITCODE -eq -1978335135) { $True } else { $False }"
      platform: win32
- crossplatform-link:
    ~/Documents/PowerShell/Profile.ps1:
      path: config/powershell/Profile.ps1
      platform: win32
    ~/AppData/Local/Packages/Microsoft.WindowsTerminal_8wekyb3d8bbwe/LocalState/settings.json:
      path: config/windows-terminal/settings.json
      force: true
      platform: win32
    ~/AppData/Local/nvim/:
      path: config/nvim/**
      glob: true
      platform: win32
- scoop:
    buckets:
      - main
      - extras
      - nerd-fonts
    apps:
      - GeistMono-NF-Mono
      # App dependencies
      - fzf
      - gcc
      - 7zip
      - make
      - nodejs
      - python
      - ripgrep
      # Apps
      - eza
      - kopiaui
      - lazygit
      - neovim
      - obsidian
      - zeal

- shell:
    - [git submodule update --init --recursive, Installing submodules]
